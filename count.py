#!/usr/bin/python3
import json
import os
def get_account(jsonPath,jsonName):
	with open(jsonPath,'r') as j:
		jsonObj = json.load(j)
		per_num=len(jsonObj['permissions'])
		hard_num=len(jsonObj['hardwareComponent'])
		pro_num=len(jsonObj['components']['providers'])
		rec_num=len(jsonObj['components']['receivers'])
		serv_num=len(jsonObj['components']['services'])
		act_num=len(jsonObj['components']['activities'])
	return (per_num,hard_num,pro_num,rec_num,serv_num,act_num)

def traverse(path):
	per=hard=pro=rec=serv=act=json_num=0
	jsons = os.listdir(path)
	for json in jsons:
		jsonPath=os.path.join(path,json)
		if (json[-4:]=='json'):
			jsonName=json[0:-5]
			try:
				json_num+=1
				(per_num,hard_num,pro_num,rec_num,serv_num,act_num)=get_account(jsonPath,jsonName)
				per+=per_num
				hard+=hard_num
				pro+=pro_num
				rec+=rec_num
				serv+=serv_num
				act+=act_num
			except Exception as e:
				print("!!fail to get"+jsonName,file=count)
				# get_permissions(apkPath,apkName)
	
	print(json_num,per,hard,pro,rec,serv,act,sep=' ',file=count)

count=open('count.txt','w')
traverse("/Users/dzih526/workspace/MalwareFeaturesCralwer/data/AndroRAT/manifest")
count.close()