#!/usr/bin/python3
from androguard.core.bytecodes.apk import APK
import os
import json

# def get_permissions(apkPath,apkName):
# 	a = APK(apkPath)
# 	jsonFile=apkName+"_perm.json"
# 	f = open(jsonFile,'w')
# 	print(a.get_permissions(),file=f)
# 	f.close()
def get_data(apkPath,apkName):
	a = APK(apkPath)
	jsonFile=apkName+".json"
	pro=a.get_providers()
	rec=a.get_receivers()
	ser=a.get_services()
	act=a.get_activities()
	per=a.get_permissions()
	data={'permissions':[],'components':{}}
	data['permissions']=per
	data['components']['providers']=pro
	data['components']['receivers']=rec
	data['components']['services']=rec
	data['components']['activities']=act
	with open(jsonFile,'w') as f:
		json.dump(data,f)

def traverse(path):
	apks = os.listdir(path)
	for apk in apks:
		apkPath=os.path.join(path,apk)
		if (apk[-3:]=='apk'):
			apkName=apk[0:-4]
			try:
				get_data(apkPath,apkName)
			except Exception as e:
				print(apkName,file=fail)
				# get_permissions(apkPath,apkName)
			
			
			
fail=open('fail.txt','w')
traverse("absolute/path/to/the/decompiled/apk/files")
fail.close()