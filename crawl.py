# -*- coding: utf-8 -*-
import os
import _thread

global i
i=0

def compile(tmpFamilyPath,tmpApkPath,family,apk):
	os.chdir(tmpFamilyPath)
	cmd = 'apktool -q d '+ tmpApkPath
	os.system(cmd)
	os.chdir(tmpApkPath[0:-4])
	os.system('rd /s /q original')
	path1=tmpFamilyPath+'\\'+apk[0:-4]
	cmd='xcopy '+path1+' C:\IntGet\input /s /e /h /q'
	os.system(cmd)
	intGet(family)
	
def intGet(family):
	global i
	os.chdir('C:\IntGet')
	os.system('IntGet.exe')
	cmd = 'ren C:\IntGet\IntGet_output.txt '+family+str(i)+'.txt'
	os.system(cmd)
	i+=1
	cmd = 'rd C:\IntGet\input /s/q'
	os.system(cmd)
	cmd = 'md C:\IntGet\input'
	os.system(cmd)

def traverse(dataset):
	global i
	families = os.listdir(dataset)
	for family in families:
		i=0;
		tmpFamilyPath = os.path.join(dataset,family)
		tmpFamilyPath = os.path.join(tmpFamilyPath,'variety1')
		os.chdir(tmpFamilyPath)
		apks = os.listdir(tmpFamilyPath)
		for apk in apks:
			tmpApkPath = os.path.join(tmpFamilyPath,apk)
			if not os.path.isdir(tmpApkPath):
				
				compile(tmpFamilyPath,tmpApkPath,family,apk)
				
            
path = 'C:\\IntGet\\dataset\\'
traverse(path)
