#!/usr/bin/python3
import json
import os
import numpy as np
import matplotlib.pyplot as plt
import sys
json_num=0
spreadList=[]
spreadList2=[]
def get_account(jsonPath,jsonName):
	with open(jsonPath,'r') as j:
		jsonObj = json.load(j)
		per_num=len(jsonObj['permissions'])
	return per_num

def traverse(path,kind):
	global json_num
	jsons = os.listdir(path)
	for json in jsons:
		jsonPath=os.path.join(path,json)
		if (json[-4:]=='json'):
			jsonName=json[0:-5]
			try:
				json_num+=1
				per_num=get_account(jsonPath,jsonName)
				print(per_num,end=' ',file=count)
				if kind == 1 :
					spreadList.append(per_num)
				if kind == 2 :
					spreadList2.append(per_num)
			except Exception as e:
				print("!!fail to get"+jsonName,file=count)
				# get_permissions(apkPath,apkName)
	

count=open('Permission_count_to_do_T_test.txt','w')
path=sys.argv[1] #the location of jsons analysing malware apks
for family in os.listdir(path):
	try:
		traverse(os.path.join(os.path.join(path,family),"manifest"),1)
	except Exception as e:
		pass
print("",end="\n")
path=sys.argv[2]  #the location of jsons analysing benigh apks
traverse((path),2)#"/Users/dzih526/workspace/MalwareFeaturesCralwer/Benigh/manifest"
count.close()
spreadList.sort()
spread=np.array(spreadList)
spread2=np.array(spreadList2)
# data = [spread, spread2, spread2[::2, 0]]
spread.shape=(-1,1)
spread2.shape=(-1,1)
spread=[spread,spread2]
#决策树
#naive bayes
